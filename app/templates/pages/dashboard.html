{% extends "layouts/app_shell.html" %}
{% set active_nav = "dashboard" %}

{% block title %}Dashboard · Gestium{% endblock %}
{% block page_title %}Panel de control{% endblock %}
{% block page_subtitle %}Resumen rápido de facturación, cobros y expedientes{% endblock %}

{% block topbar_actions %}
<button class="btn btn--primary" type="button" data-toast="Crear factura (demo)">
  <i class="ph ph-plus"></i><span class="hide-sm">Crear factura</span>
</button>
{% endblock %}

{% block content %}
  <section class="kpis">
    <div class="card"><div class="kpi">
      <div class="meta"><span>Facturación (mes)</span><b>12.480 €</b><div class="hint">+8,2% vs mes anterior</div></div>
      <div class="kpi-pill"><span class="dot dot--primary"></span> Tendencia</div>
    </div></div>

    <div class="card"><div class="kpi">
      <div class="meta"><span>Pagos pendientes</span><b>3.120 €</b><div class="hint">5 facturas abiertas</div></div>
      <div class="kpi-pill"><span class="dot dot--amber"></span> Riesgo</div>
    </div></div>

    <div class="card"><div class="kpi">
      <div class="meta"><span>Cobrado (mes)</span><b>9.360 €</b><div class="hint">Plazo medio: 17 días</div></div>
      <div class="kpi-pill"><span class="dot dot--mint"></span> Saludable</div>
    </div></div>

    <div class="card"><div class="kpi">
      <div class="meta"><span>Expedientes en curso</span><b>14</b><div class="hint">2 vencen esta semana</div></div>
      <div class="kpi-pill"><span class="dot dot--coral"></span> Atención</div>
    </div></div>
  </section>

  <section class="grid" style="grid-template-columns: 1.5fr 1fr;">
    <div class="card">
      <div class="card-hd">
        <b>Ingresos y cobros</b>
        <div class="row" style="color:var(--muted);font-size:12px;">
          <div class="tabs">
            <button class="tab is-active" data-tab-group="range" data-tab="6">6M</button>
            <button class="tab" data-tab-group="range" data-tab="12">12M</button>
            <button class="tab" data-tab-group="range" data-tab="24">24M</button>
          </div>
        </div>
      </div>
      <div class="card-bd">
        <div class="panel">
          <canvas id="chart" width="1200" height="520" style="width:100%;height:240px;"></canvas>
        </div>

        <div class="spread" style="margin:14px 0 10px;">
          <b style="font-size:13px;">Últimas facturas</b>
          <span style="font-size:12px;color:var(--muted)">Ver todas <i class="ph ph-arrow-right" style="vertical-align:-2px;"></i></span>
        </div>

        <table class="table">
          <thead><tr><th>Factura</th><th>Cliente</th><th>Importe</th><th>Estado</th></tr></thead>
          <tbody>
            <tr>
              <td><b>F-2026-0182</b><div class="sub">03/02/2026</div></td>
              <td>ACME S.L.</td>
              <td>1.240 €</td>
              <td><span class="status status--warn"><span class="status-dot"></span>Pendiente</span></td>
            </tr>
            <tr>
              <td><b>F-2026-0179</b><div class="sub">30/01/2026</div></td>
              <td>GAMMA SL</td>
              <td>890 €</td>
              <td><span class="status status--ok"><span class="status-dot"></span>Cobrada</span></td>
            </tr>
            <tr>
              <td><b>F-2026-0171</b><div class="sub">24/01/2026</div></td>
              <td>BETA S.A.</td>
              <td>1.980 €</td>
              <td><span class="status status--bad"><span class="status-dot"></span>Vencida</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="stack">
      <div class="card">
        <div class="card-hd"><b><i class="ph ph-sparkle"></i> Siguiente mejor acción</b></div>
        <div class="card-bd">
          <p style="margin:0;color:var(--muted);font-size:12px;line-height:1.4;">
            Hay 2 expedientes que vencen esta semana. Prioriza “Modelo 303 · Q4” y “IRPF · Regularización”.
          </p>
          <div class="row" style="margin-top:12px;flex-wrap:wrap;">
            <button class="btn" type="button" data-toast="Ir a expedientes (demo)"><i class="ph ph-folder-open"></i>Ver expedientes</button>
            <button class="btn btn--primary" type="button" data-toast="Automatización (demo)"><i class="ph ph-lightning"></i>Automatizar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd"><b><i class="ph ph-shield-warning"></i> Radar de riesgo</b></div>
        <div class="card-bd">
          <p style="margin:0;color:var(--muted);font-size:12px;line-height:1.4;">
            3 facturas con probabilidad de retraso. Recomendación: recordatorio para GAMMA SL.
          </p>
          <div class="row" style="margin-top:12px;flex-wrap:wrap;">
            <button class="btn" type="button" data-toast="Recordatorio enviado (demo)"><i class="ph ph-envelope-simple"></i>Recordatorio</button>
            <button class="btn" type="button" data-toast="Aging (demo)"><i class="ph ph-chart-line"></i>Aging</button>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block page_js %}
<script src="{{ url_for('static', filename='js/pages/dashboard.js') }}"></script>
{% endblock %}
