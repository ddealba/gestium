{% extends "layouts/app.html" %}

{% block title %}Detalle Case · Gestium{% endblock %}

{% block content %}
<section class="ff-grid" id="case-detail-root" data-company-id="{{ company_id }}" data-case-id="{{ case_id }}">
  <div class="ff-col-12">
    <div class="ff-card">
      <div class="ff-card__head ff-page-head">
        <h2>Detalle de case</h2>
        <a href="/app/companies/{{ company_id }}/cases" class="ff-btn ff-btn--ghost ff-btn--sm">Volver</a>
      </div>
      <div class="ff-card__body">
        <p id="case-detail-message" class="ff-form-message" aria-live="polite"></p>
        <div id="case-detail-content" class="ff-form-stack"></div>
      </div>
    </div>
  </div>

  <div class="ff-col-12">
    <div class="ff-card">
      <div class="ff-card__head ff-page-head">
        <h2>Timeline de eventos</h2>
      </div>
      <div class="ff-card__body">
        <p id="case-events-message" class="ff-form-message" aria-live="polite"></p>
        <ul id="case-events-list" class="ff-timeline"></ul>

        <form id="case-comment-form" class="ff-form-stack">
          <label class="ff-label" for="case-comment">Añadir comentario</label>
          <div class="ff-field">
            <i class="ph ph-chat-text"></i>
            <textarea id="case-comment" name="comment" class="ff-textarea" required></textarea>
          </div>
          <p id="case-comment-message" class="ff-form-message" aria-live="polite"></p>
          <button type="submit" class="ff-btn ff-btn--primary">Comentar</button>
        </form>
      </div>
    </div>
  </div>

  <div class="ff-col-12">
    <div class="ff-card">
      <div class="ff-card__head ff-page-head">
        <h2>Documentos</h2>
      </div>
      <div class="ff-card__body">
        <p id="case-documents-message" class="ff-form-message" aria-live="polite"></p>
        <div class="ff-filters" id="case-documents-filters">
          <div>
            <label class="ff-label" for="case-documents-q">Búsqueda</label>
            <input id="case-documents-q" class="ff-input" type="text" placeholder="Nombre de archivo" />
          </div>
          <div>
            <label class="ff-label" for="case-documents-status">Estado</label>
            <select id="case-documents-status" class="ff-input">
              <option value="all">Todos</option>
              <option value="pending">Pending</option>
              <option value="processed">Processed</option>
              <option value="archived">Archived</option>
            </select>
          </div>
          <div>
            <label class="ff-label" for="case-documents-doc-type">Tipo</label>
            <input id="case-documents-doc-type" class="ff-input" type="text" placeholder="dni, contrato..." />
          </div>
          <div>
            <label class="ff-label" for="case-documents-extraction">Extracción</label>
            <select id="case-documents-extraction" class="ff-input">
              <option value="all">Todos</option>
              <option value="with">Con extracción</option>
              <option value="without">Sin extracción</option>
            </select>
          </div>
          <div>
            <label class="ff-label" for="case-documents-order">Orden</label>
            <select id="case-documents-order" class="ff-input">
              <option value="created_at:desc">Creación ↓</option>
              <option value="created_at:asc">Creación ↑</option>
              <option value="status:asc">Estado ↑</option>
              <option value="status:desc">Estado ↓</option>
            </select>
          </div>
          <div class="ff-filters__actions">
            <button id="case-documents-apply" class="ff-btn ff-btn--primary" type="button">Aplicar</button>
            <button id="case-documents-clear" class="ff-btn ff-btn--ghost" type="button">Limpiar</button>
          </div>
        </div>
        <div class="ff-table-wrap">
          <table class="ff-table" id="case-documents-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Tipo</th>
                <th>Estado</th>
                <th>Extracción</th>
                <th>Fecha</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="case-documents-body"></tbody>
          </table>
        </div>
        <div class="ff-filters__actions" style="margin-top: 1rem;">
          <button id="case-documents-prev" class="ff-btn ff-btn--ghost" type="button">Anterior</button>
          <button id="case-documents-next" class="ff-btn ff-btn--ghost" type="button">Siguiente</button>
        </div>

        <form id="case-document-upload-form" class="ff-form-stack">
          <label class="ff-label" for="case-document-file">Subir documento</label>
          <input id="case-document-file" name="file" type="file" class="ff-input" required />

          <label class="ff-label" for="case-document-type">Tipo de documento (opcional)</label>
          <div class="ff-field">
            <i class="ph ph-file-text"></i>
            <select id="case-document-type" name="doc_type" class="ff-input">
              <option value="">Sin tipo</option>
              <option value="dni">DNI</option>
              <option value="contrato">Contrato</option>
              <option value="resolucion">Resolución</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <p id="case-document-upload-message" class="ff-form-message" aria-live="polite"></p>
          <button type="submit" id="case-document-upload-button" class="ff-btn ff-btn--primary">Subir</button>
        </form>
      </div>
    </div>
  </div>

  <div class="ff-col-12">
    <div class="ff-card">
      <div class="ff-card__head ff-page-head">
        <h2>Datos extraídos</h2>
      </div>
      <div class="ff-card__body">
        <div class="ff-form-stack">
          <label class="ff-label" for="extraction-document-select">Documento</label>
          <div class="ff-field">
            <i class="ph ph-file-text"></i>
            <select id="extraction-document-select" class="ff-input">
              <option value="">Selecciona un documento…</option>
            </select>
          </div>
        </div>

        <p id="extraction-latest-message" class="ff-form-message" aria-live="polite"></p>
        <pre id="extraction-latest-json" class="ff-code-block">Selecciona un documento para consultar su extracción latest.</pre>

        <form id="extraction-manual-form" class="ff-form-stack" hidden>
          <label class="ff-label" for="extraction-manual-json">Pegar JSON</label>
          <div class="ff-field" style="padding: 0;">
            <textarea
              id="extraction-manual-json"
              name="raw_json"
              class="ff-textarea"
              rows="10"
              placeholder='{"schema_version":"v1","extracted_json":{"campo":"valor"}}'
            ></textarea>
          </div>
          <p id="extraction-manual-message" class="ff-form-message" aria-live="polite"></p>
          <button type="submit" class="ff-btn ff-btn--primary">Registrar extracción</button>
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/pages/case_detail.js', v=ui_version) }}"></script>
{% endblock %}
